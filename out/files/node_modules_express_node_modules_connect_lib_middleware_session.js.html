<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>node_modules&#x2F;express&#x2F;node_modules&#x2F;connect&#x2F;lib&#x2F;middleware&#x2F;session.js</title>
    <link rel="stylesheet" href="http:&#x2F;&#x2F;yui.yahooapis.com&#x2F;3.5.1&#x2F;build&#x2F;cssgrids&#x2F;cssgrids-min.css">
    <link rel="stylesheet" href="..&#x2F;assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="..&#x2F;assets/css/main.css" id="site_styles">
    <link rel="shortcut icon" type="image/png" href="..&#x2F;assets/favicon.png">
    <script src="http:&#x2F;&#x2F;yui.yahooapis.com&#x2F;combo?3.5.1&#x2F;build&#x2F;yui&#x2F;yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
            
                <h1><img src="..&#x2F;assets/css/logo.png" title=""></h1>
            
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: </em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
    <h2 class="off-left">APIs</h2>
    <div id="api-tabview" class="tabview">
        <ul class="tabs">
            <li><a href="#api-classes">Classes</a></li>
            <li><a href="#api-modules">Modules</a></li>
        </ul>

        <div id="api-tabview-filter">
            <input type="search" id="api-filter" placeholder="Type to filter APIs">
        </div>

        <div id="api-tabview-panel">
            <ul id="api-classes" class="apis classes">
            
                <li><a href="..&#x2F;classes/Enables filtering in class lists..html">Enables filtering in class lists.</a></li>
            
                <li><a href="..&#x2F;classes/Namespace container for the JsWorld library objects..Class for localised formatting of currency amounts.

&lt;p&gt;See: &lt;a href=&quot;http:&#x2F;&#x2F;www.opengroup.org&#x2F;onlinepubs&#x2F;009695399&#x2F;basedefs&#x2F;xbd_chap07.html#tag_07_03_03&quot;&gt;
POSIX LC_MONETARY&lt;&#x2F;a&gt;..html">Namespace container for the JsWorld library objects..Class for localised formatting of currency amounts.

&lt;p&gt;See: &lt;a href=&quot;http:&#x2F;&#x2F;www.opengroup.org&#x2F;onlinepubs&#x2F;009695399&#x2F;basedefs&#x2F;xbd_chap07.html#tag_07_03_03&quot;&gt;
POSIX LC_MONETARY&lt;&#x2F;a&gt;.</a></li>
            
                <li><a href="..&#x2F;classes/Namespace container for the JsWorld library objects..Class for localised formatting of dates and times.

&lt;p&gt;See: &lt;a href=&quot;http:&#x2F;&#x2F;www.opengroup.org&#x2F;onlinepubs&#x2F;000095399&#x2F;basedefs&#x2F;xbd_chap07.html#tag_07_03_05&quot;&gt;
POSIX LC_TIME&lt;&#x2F;a&gt;..html">Namespace container for the JsWorld library objects..Class for localised formatting of dates and times.

&lt;p&gt;See: &lt;a href=&quot;http:&#x2F;&#x2F;www.opengroup.org&#x2F;onlinepubs&#x2F;000095399&#x2F;basedefs&#x2F;xbd_chap07.html#tag_07_03_05&quot;&gt;
POSIX LC_TIME&lt;&#x2F;a&gt;.</a></li>
            
                <li><a href="..&#x2F;classes/Namespace container for the JsWorld library objects..Class for localised formatting of numbers.

&lt;p&gt;See: &lt;a href=&quot;http:&#x2F;&#x2F;www.opengroup.org&#x2F;onlinepubs&#x2F;000095399&#x2F;basedefs&#x2F;xbd_chap07.html#tag_07_03_04&quot;&gt;
POSIX LC_NUMERIC&lt;&#x2F;a&gt;..html">Namespace container for the JsWorld library objects..Class for localised formatting of numbers.

&lt;p&gt;See: &lt;a href=&quot;http:&#x2F;&#x2F;www.opengroup.org&#x2F;onlinepubs&#x2F;000095399&#x2F;basedefs&#x2F;xbd_chap07.html#tag_07_03_04&quot;&gt;
POSIX LC_NUMERIC&lt;&#x2F;a&gt;.</a></li>
            
                <li><a href="..&#x2F;classes/Namespace container for the JsWorld library objects..Class for parsing localised currency amount strings..html">Namespace container for the JsWorld library objects..Class for parsing localised currency amount strings.</a></li>
            
                <li><a href="..&#x2F;classes/Namespace container for the JsWorld library objects..Class for parsing localised date and time strings..html">Namespace container for the JsWorld library objects..Class for parsing localised date and time strings.</a></li>
            
                <li><a href="..&#x2F;classes/Namespace container for the JsWorld library objects..Class for parsing localised number strings..html">Namespace container for the JsWorld library objects..Class for parsing localised number strings.</a></li>
            
                <li><a href="..&#x2F;classes/Namespace container for the JsWorld library objects..Represents a POSIX-style locale with its numeric, monetary and date&#x2F;time 
properties. Also provides a set of locale helper methods.

&lt;p&gt;The locale properties follow the POSIX standards:

&lt;ul&gt;
    &lt;li&gt;&lt;a href=&quot;http:&#x2F;&#x2F;www.opengroup.org&#x2F;onlinepubs&#x2F;000095399&#x2F;basedefs&#x2F;xbd_chap07.html#tag_07_03_04&quot;&gt;POSIX LC_NUMERIC&lt;&#x2F;a&gt;
    &lt;li&gt;&lt;a href=&quot;http:&#x2F;&#x2F;www.opengroup.org&#x2F;onlinepubs&#x2F;009695399&#x2F;basedefs&#x2F;xbd_chap07.html#tag_07_03_03&quot;&gt;POSIX LC_MONETARY&lt;&#x2F;a&gt;
    &lt;li&gt;&lt;a href=&quot;http:&#x2F;&#x2F;www.opengroup.org&#x2F;onlinepubs&#x2F;000095399&#x2F;basedefs&#x2F;xbd_chap07.html#tag_07_03_05&quot;&gt;POSIX LC_TIME&lt;&#x2F;a&gt;
&lt;&#x2F;ul&gt;.html">Namespace container for the JsWorld library objects..Represents a POSIX-style locale with its numeric, monetary and date&#x2F;time 
properties. Also provides a set of locale helper methods.

&lt;p&gt;The locale properties follow the POSIX standards:

&lt;ul&gt;
    &lt;li&gt;&lt;a href=&quot;http:&#x2F;&#x2F;www.opengroup.org&#x2F;onlinepubs&#x2F;000095399&#x2F;basedefs&#x2F;xbd_chap07.html#tag_07_03_04&quot;&gt;POSIX LC_NUMERIC&lt;&#x2F;a&gt;
    &lt;li&gt;&lt;a href=&quot;http:&#x2F;&#x2F;www.opengroup.org&#x2F;onlinepubs&#x2F;009695399&#x2F;basedefs&#x2F;xbd_chap07.html#tag_07_03_03&quot;&gt;POSIX LC_MONETARY&lt;&#x2F;a&gt;
    &lt;li&gt;&lt;a href=&quot;http:&#x2F;&#x2F;www.opengroup.org&#x2F;onlinepubs&#x2F;000095399&#x2F;basedefs&#x2F;xbd_chap07.html#tag_07_03_05&quot;&gt;POSIX LC_TIME&lt;&#x2F;a&gt;
&lt;&#x2F;ul&gt;</a></li>
            
            </ul>

            <ul id="api-modules" class="apis modules">
            
            </ul>
        </div>
    </div>
</div>

            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
        Show:
        <label for="api-show-inherited">
            <input type="checkbox" id="api-show-inherited" checked>
            Inherited
        </label>

        <label for="api-show-protected">
            <input type="checkbox" id="api-show-protected">
            Protected
        </label>

        <label for="api-show-private">
            <input type="checkbox" id="api-show-private">
            Private
        </label>
        <label for="api-show-deprecated">
            <input type="checkbox" id="api-show-deprecated">
            Deprecated
        </label>

    </div>


            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
                        <h1 class="file-heading">File: node_modules&#x2F;express&#x2F;node_modules&#x2F;connect&#x2F;lib&#x2F;middleware&#x2F;session.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">

&#x2F;*!
 * Connect - session
 * Copyright(c) 2010 Sencha Inc.
 * Copyright(c) 2011 TJ Holowaychuk
 * MIT Licensed
 *&#x2F;

&#x2F;**
 * Module dependencies.
 *&#x2F;

var Session = require(&#x27;.&#x2F;session&#x2F;session&#x27;)
  , MemoryStore = require(&#x27;.&#x2F;session&#x2F;memory&#x27;)
  , Cookie = require(&#x27;.&#x2F;session&#x2F;cookie&#x27;)
  , Store = require(&#x27;.&#x2F;session&#x2F;store&#x27;)
  , utils = require(&#x27;.&#x2F;..&#x2F;utils&#x27;)
  , parse = require(&#x27;url&#x27;).parse
  , crypto = require(&#x27;crypto&#x27;);

&#x2F;&#x2F; environment

var env = process.env.NODE_ENV;

&#x2F;**
 * Expose the middleware.
 *&#x2F;

exports = module.exports = session;

&#x2F;**
 * Expose constructors.
 *&#x2F;

exports.Store = Store;
exports.Cookie = Cookie;
exports.Session = Session;
exports.MemoryStore = MemoryStore;

&#x2F;**
 * Warning message for &#x60;MemoryStore&#x60; usage in production.
 *&#x2F;

var warning = &#x27;Warning: connection.session() MemoryStore is not\n&#x27;
  + &#x27;designed for a production environment, as it will leak\n&#x27;
  + &#x27;memory, and obviously only work within a single process.&#x27;;

&#x2F;**
 * Default finger-printing function.
 *&#x2F;

function defaultFingerprint(req) {
  return &#x27;&#x27;;
};

&#x2F;**
 * Paths to ignore.
 *&#x2F;

exports.ignore = [];

&#x2F;**
 * Setup session store with the given &#x60;options&#x60;.
 *
 * Session data is _not_ saved in the cookie itself, however
 * cookies are used, so we must use the [cookieParser()](middleware-cookieParser.html)
 * middleware _before_ &#x60;session()&#x60;.
 *
 * Examples:
 *
 *     connect.createServer(
 *         connect.cookieParser()
 *       , connect.session({ secret: &#x27;keyboard cat&#x27; })
 *     );
 *
 * Options:
 *
 *   - &#x60;key&#x60;           cookie name defaulting to &#x60;connect.sid&#x60;
 *   - &#x60;store&#x60;         Session store instance
 *   - &#x60;fingerprint&#x60;   Custom fingerprint generating function
 *   - &#x60;cookie&#x60;        Session cookie settings, defaulting to &#x60;{ path: &#x27;&#x2F;&#x27;, httpOnly: true, maxAge: 14400000 }&#x60;
 *   - &#x60;secret&#x60;        Secret string used to compute hash
 *
 * Ignore Paths:
 *
 *  By default &#x60;&#x2F;favicon.ico&#x60; is the only ignored path, all others
 *  will utilize sessions, to manipulate the paths ignored, use
 * &#x60;connect.session.ignore.push(&#x27;&#x2F;my&#x2F;path&#x27;)&#x60;. This works for _full_
 *  pathnames only, not segments nor substrings.
 *
 *     connect.session.ignore.push(&#x27;&#x2F;robots.txt&#x27;);
 *
 * ## req.session
 *
 *  To store or access session data, simply use the request property &#x60;req.session&#x60;,
 *  which is (generally) serialized as JSON by the store, so nested objects 
 *  are typically fine. For example below is a user-specific view counter:
 *
 *       connect(
 *           connect.cookieParser()
 *         , connect.session({ secret: &#x27;keyboard cat&#x27;, cookie: { maxAge: 60000 }})
 *         , connect.favicon()
 *         , function(req, res, next){
 *           var sess = req.session;
 *           if (sess.views) {
 *             res.setHeader(&#x27;Content-Type&#x27;, &#x27;text&#x2F;html&#x27;);
 *             res.write(&#x27;&lt;p&gt;views: &#x27; + sess.views + &#x27;&lt;&#x2F;p&gt;&#x27;);
 *             res.write(&#x27;&lt;p&gt;expires in: &#x27; + (sess.cookie.maxAge &#x2F; 1000) + &#x27;s&lt;&#x2F;p&gt;&#x27;);
 *             res.end();
 *             sess.views++;
 *           } else {
 *             sess.views = 1;
 *             res.end(&#x27;welcome to the session demo. refresh!&#x27;);
 *           }
 *         }
 *       ).listen(3000);
 *
 * ## Session#regenerate()
 *
 *  To regenerate the session simply invoke the method, once complete
 *  a new SID and &#x60;Session&#x60; instance will be initialized at &#x60;req.session&#x60;.
 *
 *      req.session.regenerate(function(err){
 *        &#x2F;&#x2F; will have a new session here
 *      });
 *
 * ## Session#destroy()
 *
 *  Destroys the session, removing &#x60;req.session&#x60;, will be re-generated next request.
 *
 *      req.session.destroy(function(err){
 *        &#x2F;&#x2F; cannot access session here
 *      });
 * 
 * ## Session#reload()
 *
 *  Reloads the session data.
 *
 *      req.session.reload(function(err){
 *        &#x2F;&#x2F; session updated
 *      });
 *
 * ## Session#save()
 *
 *  Save the session.
 *
 *      req.session.save(function(err){
 *        &#x2F;&#x2F; session saved
 *      });
 *
 * ## Session#touch()
 *
 *   Updates the &#x60;.maxAge&#x60;, and &#x60;.lastAccess&#x60; properties. Typically this is
 *   not necessary to call, as the session middleware does this for you.
 *
 * ## Session#cookie
 *
 *  Each session has a unique cookie object accompany it. This allows
 *  you to alter the session cookie per visitor. For example we can
 *  set &#x60;req.session.cookie.expires&#x60; to &#x60;false&#x60; to enable the cookie
 *  to remain for only the duration of the user-agent.
 *
 * ## Session#maxAge
 *
 *  Alternatively &#x60;req.session.cookie.maxAge&#x60; will return the time
 *  remaining in milliseconds, which we may also re-assign a new value
 *  to adjust the &#x60;.expires&#x60; property appropriately. The following
 *  are essentially equivalent
 *
 *     var hour = 3600000;
 *     req.session.cookie.expires = new Date(Date.now() + hour);
 *     req.session.cookie.maxAge = hour;
 *
 * For example when &#x60;maxAge&#x60; is set to &#x60;60000&#x60; (one minute), and 30 seconds
 * has elapsed it will return &#x60;30000&#x60; until the current request has completed,
 * at which time &#x60;req.session.touch()&#x60; is called to update &#x60;req.session.lastAccess&#x60;,
 * and reset &#x60;req.session.maxAge&#x60; to its original value.
 *
 *     req.session.cookie.maxAge;
 *     &#x2F;&#x2F; =&gt; 30000
 *
 * Session Store Implementation:
 *
 * Every session store _must_ implement the following methods
 *
 *    - &#x60;.get(sid, callback)&#x60;
 *    - &#x60;.set(sid, session, callback)&#x60;
 *    - &#x60;.destroy(sid, callback)&#x60;
 *
 * Recommended methods include, but are not limited to:
 *
 *    - &#x60;.length(callback)&#x60;
 *    - &#x60;.clear(callback)&#x60;
 *
 * For an example implementation view the [connect-redis](http:&#x2F;&#x2F;github.com&#x2F;visionmedia&#x2F;connect-redis) repo.
 *
 * @param {Object} options
 * @return {Function}
 * @api public
 *&#x2F;

function session(options){
  var options = options || {}
    , key = options.key || &#x27;connect.sid&#x27;
    , secret = options.secret
    , store = options.store || new MemoryStore
    , fingerprint = options.fingerprint || defaultFingerprint
    , cookie = options.cookie;

  &#x2F;&#x2F; notify user that this store is not
  &#x2F;&#x2F; meant for a production environment
  if (&#x27;production&#x27; == env &amp;&amp; store instanceof MemoryStore) {
    console.warn(warning);
  }

  &#x2F;&#x2F; ensure secret is present
  if (!secret) {
    throw new Error(&#x27;connect.session({ secret: &quot;string&quot; }) required for security&#x27;);
  }

  &#x2F;&#x2F; session hashing function
  store.hash = function(req, base) {
    return crypto
      .createHmac(&#x27;sha256&#x27;, secret)
      .update(base + fingerprint(req))
      .digest(&#x27;base64&#x27;)
      .replace(&#x2F;=*$&#x2F;, &#x27;&#x27;);
  };

  &#x2F;&#x2F; generates the new session
  store.generate = function(req){
    var base = utils.uid(24);
    var sessionID = base + &#x27;.&#x27; + store.hash(req, base);
    req.sessionID = sessionID;
    req.session = new Session(req);
    req.session.cookie = new Cookie(cookie);
  };

  return function session(req, res, next) {
    &#x2F;&#x2F; self-awareness
    if (req.session) return next();

    &#x2F;&#x2F; parse url
    var url = parse(req.url)
      , path = url.pathname;

    &#x2F;&#x2F; ignorable paths
    if (~exports.ignore.indexOf(path)) return next();

    &#x2F;&#x2F; expose store
    req.sessionStore = store;

    &#x2F;&#x2F; proxy writeHead() to Set-Cookie
    var writeHead = res.writeHead;
    res.writeHead = function(status, headers){
      if (req.session) {
        var cookie = req.session.cookie;
        &#x2F;&#x2F; only send secure session cookies when there is a secure connection.
        &#x2F;&#x2F; proxySecure is a custom attribute to allow for a reverse proxy
        &#x2F;&#x2F; to handle SSL connections and to communicate to connect over HTTP that
        &#x2F;&#x2F; the incoming connection is secure.
        var secured = cookie.secure &amp;&amp; (req.connection.encrypted || req.connection.proxySecure);
        if (secured || !cookie.secure) {
          res.setHeader(&#x27;Set-Cookie&#x27;, cookie.serialize(key, req.sessionID));
        }
      }

      res.writeHead = writeHead;
      return res.writeHead(status, headers);
    };

    &#x2F;&#x2F; proxy end() to commit the session
    var end = res.end;
    res.end = function(data, encoding){
      res.end = end;
      if (req.session) {
        &#x2F;&#x2F; HACK: ensure Set-Cookie for implicit writeHead()
        if (!res._header) res._implicitHeader();
        req.session.resetMaxAge();
        req.session.save(function(){
          res.end(data, encoding);
        });
      } else {
        res.end(data, encoding);
      }
    };

    &#x2F;&#x2F; session hashing
    function hash(base) {
      return store.hash(req, base);
    }

    &#x2F;&#x2F; generate the session
    function generate() {
      store.generate(req);
    }

    &#x2F;&#x2F; get the sessionID from the cookie
    req.sessionID = req.cookies[key];

    &#x2F;&#x2F; make a new session if the browser doesn&#x27;t send a sessionID
    if (!req.sessionID) {
      generate();
      next();
      return;
    }

    &#x2F;&#x2F; check the fingerprint
    var parts = req.sessionID.split(&#x27;.&#x27;);
    if (parts[1] != hash(parts[0])) {
      generate();
      next();
      return;
    }

    &#x2F;&#x2F; generate the session object
    var pause = utils.pause(req);
    store.get(req.sessionID, function(err, sess){
      &#x2F;&#x2F; proxy to resume() events
      var _next = next;
      next = function(err){
        _next(err);
        pause.resume();
      }

      &#x2F;&#x2F; error handling
      if (err) {
        if (&#x27;ENOENT&#x27; == err.code) {
          generate();
          next();
        } else {
          next(err);
        }
      &#x2F;&#x2F; no session
      } else if (!sess) {
        generate();
        next();
      &#x2F;&#x2F; populate req.session
      } else {
        store.createSession(req, sess);
        next();
      }
    });
  };
};

    </pre>
</div>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="..&#x2F;assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="..&#x2F;assets/js/yui-prettify.js"></script>
<script src="..&#x2F;assets/../api.js"></script>
<script src="..&#x2F;assets/js/api-filter.js"></script>
<script src="..&#x2F;assets/js/api-list.js"></script>
<script src="..&#x2F;assets/js/api-search.js"></script>
<script src="..&#x2F;assets/js/apidocs.js"></script>
</body>
</html>
