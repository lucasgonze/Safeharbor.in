<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>node_modules&#x2F;connect-cookie-session&#x2F;node_modules&#x2F;connect&#x2F;lib&#x2F;middleware&#x2F;directory.js</title>
    <link rel="stylesheet" href="http:&#x2F;&#x2F;yui.yahooapis.com&#x2F;3.5.1&#x2F;build&#x2F;cssgrids&#x2F;cssgrids-min.css">
    <link rel="stylesheet" href="..&#x2F;assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="..&#x2F;assets/css/main.css" id="site_styles">
    <link rel="shortcut icon" type="image/png" href="..&#x2F;assets/favicon.png">
    <script src="http:&#x2F;&#x2F;yui.yahooapis.com&#x2F;combo?3.5.1&#x2F;build&#x2F;yui&#x2F;yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
            
                <h1><img src="..&#x2F;assets/css/logo.png" title=""></h1>
            
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: </em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
    <h2 class="off-left">APIs</h2>
    <div id="api-tabview" class="tabview">
        <ul class="tabs">
            <li><a href="#api-classes">Classes</a></li>
            <li><a href="#api-modules">Modules</a></li>
        </ul>

        <div id="api-tabview-filter">
            <input type="search" id="api-filter" placeholder="Type to filter APIs">
        </div>

        <div id="api-tabview-panel">
            <ul id="api-classes" class="apis classes">
            
                <li><a href="..&#x2F;classes/Enables filtering in class lists..html">Enables filtering in class lists.</a></li>
            
                <li><a href="..&#x2F;classes/Namespace container for the JsWorld library objects..Class for localised formatting of currency amounts.

&lt;p&gt;See: &lt;a href=&quot;http:&#x2F;&#x2F;www.opengroup.org&#x2F;onlinepubs&#x2F;009695399&#x2F;basedefs&#x2F;xbd_chap07.html#tag_07_03_03&quot;&gt;
POSIX LC_MONETARY&lt;&#x2F;a&gt;..html">Namespace container for the JsWorld library objects..Class for localised formatting of currency amounts.

&lt;p&gt;See: &lt;a href=&quot;http:&#x2F;&#x2F;www.opengroup.org&#x2F;onlinepubs&#x2F;009695399&#x2F;basedefs&#x2F;xbd_chap07.html#tag_07_03_03&quot;&gt;
POSIX LC_MONETARY&lt;&#x2F;a&gt;.</a></li>
            
                <li><a href="..&#x2F;classes/Namespace container for the JsWorld library objects..Class for localised formatting of dates and times.

&lt;p&gt;See: &lt;a href=&quot;http:&#x2F;&#x2F;www.opengroup.org&#x2F;onlinepubs&#x2F;000095399&#x2F;basedefs&#x2F;xbd_chap07.html#tag_07_03_05&quot;&gt;
POSIX LC_TIME&lt;&#x2F;a&gt;..html">Namespace container for the JsWorld library objects..Class for localised formatting of dates and times.

&lt;p&gt;See: &lt;a href=&quot;http:&#x2F;&#x2F;www.opengroup.org&#x2F;onlinepubs&#x2F;000095399&#x2F;basedefs&#x2F;xbd_chap07.html#tag_07_03_05&quot;&gt;
POSIX LC_TIME&lt;&#x2F;a&gt;.</a></li>
            
                <li><a href="..&#x2F;classes/Namespace container for the JsWorld library objects..Class for localised formatting of numbers.

&lt;p&gt;See: &lt;a href=&quot;http:&#x2F;&#x2F;www.opengroup.org&#x2F;onlinepubs&#x2F;000095399&#x2F;basedefs&#x2F;xbd_chap07.html#tag_07_03_04&quot;&gt;
POSIX LC_NUMERIC&lt;&#x2F;a&gt;..html">Namespace container for the JsWorld library objects..Class for localised formatting of numbers.

&lt;p&gt;See: &lt;a href=&quot;http:&#x2F;&#x2F;www.opengroup.org&#x2F;onlinepubs&#x2F;000095399&#x2F;basedefs&#x2F;xbd_chap07.html#tag_07_03_04&quot;&gt;
POSIX LC_NUMERIC&lt;&#x2F;a&gt;.</a></li>
            
                <li><a href="..&#x2F;classes/Namespace container for the JsWorld library objects..Class for parsing localised currency amount strings..html">Namespace container for the JsWorld library objects..Class for parsing localised currency amount strings.</a></li>
            
                <li><a href="..&#x2F;classes/Namespace container for the JsWorld library objects..Class for parsing localised date and time strings..html">Namespace container for the JsWorld library objects..Class for parsing localised date and time strings.</a></li>
            
                <li><a href="..&#x2F;classes/Namespace container for the JsWorld library objects..Class for parsing localised number strings..html">Namespace container for the JsWorld library objects..Class for parsing localised number strings.</a></li>
            
                <li><a href="..&#x2F;classes/Namespace container for the JsWorld library objects..Represents a POSIX-style locale with its numeric, monetary and date&#x2F;time 
properties. Also provides a set of locale helper methods.

&lt;p&gt;The locale properties follow the POSIX standards:

&lt;ul&gt;
    &lt;li&gt;&lt;a href=&quot;http:&#x2F;&#x2F;www.opengroup.org&#x2F;onlinepubs&#x2F;000095399&#x2F;basedefs&#x2F;xbd_chap07.html#tag_07_03_04&quot;&gt;POSIX LC_NUMERIC&lt;&#x2F;a&gt;
    &lt;li&gt;&lt;a href=&quot;http:&#x2F;&#x2F;www.opengroup.org&#x2F;onlinepubs&#x2F;009695399&#x2F;basedefs&#x2F;xbd_chap07.html#tag_07_03_03&quot;&gt;POSIX LC_MONETARY&lt;&#x2F;a&gt;
    &lt;li&gt;&lt;a href=&quot;http:&#x2F;&#x2F;www.opengroup.org&#x2F;onlinepubs&#x2F;000095399&#x2F;basedefs&#x2F;xbd_chap07.html#tag_07_03_05&quot;&gt;POSIX LC_TIME&lt;&#x2F;a&gt;
&lt;&#x2F;ul&gt;.html">Namespace container for the JsWorld library objects..Represents a POSIX-style locale with its numeric, monetary and date&#x2F;time 
properties. Also provides a set of locale helper methods.

&lt;p&gt;The locale properties follow the POSIX standards:

&lt;ul&gt;
    &lt;li&gt;&lt;a href=&quot;http:&#x2F;&#x2F;www.opengroup.org&#x2F;onlinepubs&#x2F;000095399&#x2F;basedefs&#x2F;xbd_chap07.html#tag_07_03_04&quot;&gt;POSIX LC_NUMERIC&lt;&#x2F;a&gt;
    &lt;li&gt;&lt;a href=&quot;http:&#x2F;&#x2F;www.opengroup.org&#x2F;onlinepubs&#x2F;009695399&#x2F;basedefs&#x2F;xbd_chap07.html#tag_07_03_03&quot;&gt;POSIX LC_MONETARY&lt;&#x2F;a&gt;
    &lt;li&gt;&lt;a href=&quot;http:&#x2F;&#x2F;www.opengroup.org&#x2F;onlinepubs&#x2F;000095399&#x2F;basedefs&#x2F;xbd_chap07.html#tag_07_03_05&quot;&gt;POSIX LC_TIME&lt;&#x2F;a&gt;
&lt;&#x2F;ul&gt;</a></li>
            
            </ul>

            <ul id="api-modules" class="apis modules">
            
            </ul>
        </div>
    </div>
</div>

            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
        Show:
        <label for="api-show-inherited">
            <input type="checkbox" id="api-show-inherited" checked>
            Inherited
        </label>

        <label for="api-show-protected">
            <input type="checkbox" id="api-show-protected">
            Protected
        </label>

        <label for="api-show-private">
            <input type="checkbox" id="api-show-private">
            Private
        </label>
        <label for="api-show-deprecated">
            <input type="checkbox" id="api-show-deprecated">
            Deprecated
        </label>

    </div>


            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
                        <h1 class="file-heading">File: node_modules&#x2F;connect-cookie-session&#x2F;node_modules&#x2F;connect&#x2F;lib&#x2F;middleware&#x2F;directory.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">

&#x2F;*!
 * Connect - directory
 * Copyright(c) 2011 Sencha Inc.
 * Copyright(c) 2011 TJ Holowaychuk
 * MIT Licensed
 *&#x2F;

&#x2F;&#x2F; TODO: icon &#x2F; style for directories
&#x2F;&#x2F; TODO: arrow key navigation
&#x2F;&#x2F; TODO: make icons extensible

&#x2F;**
 * Module dependencies.
 *&#x2F;

var fs = require(&#x27;fs&#x27;)
  , parse = require(&#x27;url&#x27;).parse
  , utils = require(&#x27;..&#x2F;utils&#x27;)
  , path = require(&#x27;path&#x27;)
  , normalize = path.normalize
  , extname = path.extname
  , join = path.join;

&#x2F;*!
 * Icon cache.
 *&#x2F;

var cache = {};

&#x2F;**
 * Directory:
 *
 * Serve directory listings with the given &#x60;root&#x60; path.
 *
 * Options:
 *
 *  - &#x60;hidden&#x60; display hidden (dot) files. Defaults to false.
 *  - &#x60;icons&#x60;  display icons. Defaults to false.
 *  - &#x60;filter&#x60; Apply this filter function to files. Defaults to false.
 *
 * @param {String} root
 * @param {Object} options
 * @return {Function}
 * @api public
 *&#x2F;

exports = module.exports = function directory(root, options){
  options = options || {};

  &#x2F;&#x2F; root required
  if (!root) throw new Error(&#x27;directory() root path required&#x27;);
  var hidden = options.hidden
    , icons = options.icons
    , filter = options.filter
    , root = normalize(root);

  return function directory(req, res, next) {
    var accept = req.headers.accept || &#x27;text&#x2F;plain&#x27;
      , url = parse(req.url)
      , dir = decodeURIComponent(url.pathname)
      , path = normalize(join(root, dir))
      , originalUrl = parse(req.originalUrl)
      , originalDir = decodeURIComponent(originalUrl.pathname)
      , showUp = path != root &amp;&amp; path != root + &#x27;&#x2F;&#x27;;

    &#x2F;&#x2F; null byte(s), bad request
    if (~path.indexOf(&#x27;\0&#x27;)) return next(utils.error(400));

    &#x2F;&#x2F; malicious path, forbidden
    if (0 != path.indexOf(root)) return next(utils.error(403));

    &#x2F;&#x2F; check if we have a directory
    fs.stat(path, function(err, stat){
      if (err) return &#x27;ENOENT&#x27; == err.code
        ? next()
        : next(err);

      if (!stat.isDirectory()) return next();

      &#x2F;&#x2F; fetch files
      fs.readdir(path, function(err, files){
        if (err) return next(err);
        if (!hidden) files = removeHidden(files);
        if (filter) files = files.filter(filter);
        files.sort();

        &#x2F;&#x2F; content-negotiation
        for (var key in exports) {
          if (~accept.indexOf(key) || ~accept.indexOf(&#x27;*&#x2F;*&#x27;)) {
            exports[key](req, res, files, next, originalDir, showUp, icons);
            return;
          }
        }

        &#x2F;&#x2F; not acceptable
        next(utils.error(406));
      });
    });
  };
};

&#x2F;**
 * Respond with text&#x2F;html.
 *&#x2F;

exports.html = function(req, res, files, next, dir, showUp, icons){
  fs.readFile(__dirname + &#x27;&#x2F;..&#x2F;public&#x2F;directory.html&#x27;, &#x27;utf8&#x27;, function(err, str){
    if (err) return next(err);
    fs.readFile(__dirname + &#x27;&#x2F;..&#x2F;public&#x2F;style.css&#x27;, &#x27;utf8&#x27;, function(err, style){
      if (err) return next(err);
      if (showUp) files.unshift(&#x27;..&#x27;);
      str = str
        .replace(&#x27;{style}&#x27;, style)
        .replace(&#x27;{files}&#x27;, html(files, dir, icons))
        .replace(&#x27;{directory}&#x27;, dir)
        .replace(&#x27;{linked-path}&#x27;, htmlPath(dir));
      res.setHeader(&#x27;Content-Type&#x27;, &#x27;text&#x2F;html&#x27;);
      res.setHeader(&#x27;Content-Length&#x27;, str.length);
      res.end(str);
    });
  });
};

&#x2F;**
 * Respond with application&#x2F;json.
 *&#x2F;

exports.json = function(req, res, files){
  files = JSON.stringify(files);
  res.setHeader(&#x27;Content-Type&#x27;, &#x27;application&#x2F;json&#x27;);
  res.setHeader(&#x27;Content-Length&#x27;, files.length);
  res.end(files);
};

&#x2F;**
 * Respond with text&#x2F;plain.
 *&#x2F;

exports.plain = function(req, res, files){
  files = files.join(&#x27;\n&#x27;) + &#x27;\n&#x27;;
  res.setHeader(&#x27;Content-Type&#x27;, &#x27;text&#x2F;plain&#x27;);
  res.setHeader(&#x27;Content-Length&#x27;, files.length);
  res.end(files);
};

&#x2F;**
 * Map html &#x60;dir&#x60;, returning a linked path.
 *&#x2F;

function htmlPath(dir) {
  var curr = [];
  return dir.split(&#x27;&#x2F;&#x27;).map(function(part){
    curr.push(part);
    return &#x27;&lt;a href=&quot;&#x27; + curr.join(&#x27;&#x2F;&#x27;) + &#x27;&quot;&gt;&#x27; + part + &#x27;&lt;&#x2F;a&gt;&#x27;;
  }).join(&#x27; &#x2F; &#x27;);
}

&#x2F;**
 * Map html &#x60;files&#x60;, returning an html unordered list.
 *&#x2F;

function html(files, dir, useIcons) {
  return &#x27;&lt;ul id=&quot;files&quot;&gt;&#x27; + files.map(function(file){
    var icon = &#x27;&#x27;
      , classes = [];

    if (useIcons &amp;&amp; &#x27;..&#x27; != file) {
      icon = icons[extname(file)] || icons.default;
      icon = &#x27;&lt;img src=&quot;data:image&#x2F;png;base64,&#x27; + load(icon) + &#x27;&quot; &#x2F;&gt;&#x27;;
      classes.push(&#x27;icon&#x27;);
    }

    return &#x27;&lt;li&gt;&lt;a href=&quot;&#x27;
      + join(dir, file)
      + &#x27;&quot; class=&quot;&#x27;
      + classes.join(&#x27; &#x27;) + &#x27;&quot;&#x27;
      + &#x27; title=&quot;&#x27; + file + &#x27;&quot;&gt;&#x27;
      + icon + file + &#x27;&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;&#x27;;

  }).join(&#x27;\n&#x27;) + &#x27;&lt;&#x2F;ul&gt;&#x27;;
}

&#x2F;**
 * Load and cache the given &#x60;icon&#x60;.
 *
 * @param {String} icon
 * @return {String}
 * @api private
 *&#x2F;

function load(icon) {
  if (cache[icon]) return cache[icon];
  return cache[icon] = fs.readFileSync(__dirname + &#x27;&#x2F;..&#x2F;public&#x2F;icons&#x2F;&#x27; + icon, &#x27;base64&#x27;);
}

&#x2F;**
 * Filter &quot;hidden&quot; &#x60;files&#x60;, aka files
 * beginning with a &#x60;.&#x60;.
 *
 * @param {Array} files
 * @return {Array}
 * @api private
 *&#x2F;

function removeHidden(files) {
  return files.filter(function(file){
    return &#x27;.&#x27; != file[0];
  });
}

&#x2F;**
 * Icon map.
 *&#x2F;

var icons = {
    &#x27;.js&#x27;: &#x27;page_white_code_red.png&#x27;
  , &#x27;.c&#x27;: &#x27;page_white_c.png&#x27;
  , &#x27;.h&#x27;: &#x27;page_white_h.png&#x27;
  , &#x27;.cc&#x27;: &#x27;page_white_cplusplus.png&#x27;
  , &#x27;.php&#x27;: &#x27;page_white_php.png&#x27;
  , &#x27;.rb&#x27;: &#x27;page_white_ruby.png&#x27;
  , &#x27;.cpp&#x27;: &#x27;page_white_cplusplus.png&#x27;
  , &#x27;.swf&#x27;: &#x27;page_white_flash.png&#x27;
  , &#x27;.pdf&#x27;: &#x27;page_white_acrobat.png&#x27;
  , &#x27;default&#x27;: &#x27;page_white.png&#x27;
};

    </pre>
</div>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="..&#x2F;assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="..&#x2F;assets/js/yui-prettify.js"></script>
<script src="..&#x2F;assets/../api.js"></script>
<script src="..&#x2F;assets/js/api-filter.js"></script>
<script src="..&#x2F;assets/js/api-list.js"></script>
<script src="..&#x2F;assets/js/api-search.js"></script>
<script src="..&#x2F;assets/js/apidocs.js"></script>
</body>
</html>
