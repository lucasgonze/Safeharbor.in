<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>node_modules&#x2F;sendgrid&#x2F;node_modules&#x2F;nodemailer&#x2F;lib&#x2F;nodemailer.js</title>
    <link rel="stylesheet" href="http:&#x2F;&#x2F;yui.yahooapis.com&#x2F;3.5.1&#x2F;build&#x2F;cssgrids&#x2F;cssgrids-min.css">
    <link rel="stylesheet" href="..&#x2F;assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="..&#x2F;assets/css/main.css" id="site_styles">
    <link rel="shortcut icon" type="image/png" href="..&#x2F;assets/favicon.png">
    <script src="http:&#x2F;&#x2F;yui.yahooapis.com&#x2F;combo?3.5.1&#x2F;build&#x2F;yui&#x2F;yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
            
                <h1><img src="..&#x2F;assets/css/logo.png" title=""></h1>
            
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: </em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
    <h2 class="off-left">APIs</h2>
    <div id="api-tabview" class="tabview">
        <ul class="tabs">
            <li><a href="#api-classes">Classes</a></li>
            <li><a href="#api-modules">Modules</a></li>
        </ul>

        <div id="api-tabview-filter">
            <input type="search" id="api-filter" placeholder="Type to filter APIs">
        </div>

        <div id="api-tabview-panel">
            <ul id="api-classes" class="apis classes">
            
                <li><a href="..&#x2F;classes/Enables filtering in class lists..html">Enables filtering in class lists.</a></li>
            
                <li><a href="..&#x2F;classes/Namespace container for the JsWorld library objects..Class for localised formatting of currency amounts.

&lt;p&gt;See: &lt;a href=&quot;http:&#x2F;&#x2F;www.opengroup.org&#x2F;onlinepubs&#x2F;009695399&#x2F;basedefs&#x2F;xbd_chap07.html#tag_07_03_03&quot;&gt;
POSIX LC_MONETARY&lt;&#x2F;a&gt;..html">Namespace container for the JsWorld library objects..Class for localised formatting of currency amounts.

&lt;p&gt;See: &lt;a href=&quot;http:&#x2F;&#x2F;www.opengroup.org&#x2F;onlinepubs&#x2F;009695399&#x2F;basedefs&#x2F;xbd_chap07.html#tag_07_03_03&quot;&gt;
POSIX LC_MONETARY&lt;&#x2F;a&gt;.</a></li>
            
                <li><a href="..&#x2F;classes/Namespace container for the JsWorld library objects..Class for localised formatting of dates and times.

&lt;p&gt;See: &lt;a href=&quot;http:&#x2F;&#x2F;www.opengroup.org&#x2F;onlinepubs&#x2F;000095399&#x2F;basedefs&#x2F;xbd_chap07.html#tag_07_03_05&quot;&gt;
POSIX LC_TIME&lt;&#x2F;a&gt;..html">Namespace container for the JsWorld library objects..Class for localised formatting of dates and times.

&lt;p&gt;See: &lt;a href=&quot;http:&#x2F;&#x2F;www.opengroup.org&#x2F;onlinepubs&#x2F;000095399&#x2F;basedefs&#x2F;xbd_chap07.html#tag_07_03_05&quot;&gt;
POSIX LC_TIME&lt;&#x2F;a&gt;.</a></li>
            
                <li><a href="..&#x2F;classes/Namespace container for the JsWorld library objects..Class for localised formatting of numbers.

&lt;p&gt;See: &lt;a href=&quot;http:&#x2F;&#x2F;www.opengroup.org&#x2F;onlinepubs&#x2F;000095399&#x2F;basedefs&#x2F;xbd_chap07.html#tag_07_03_04&quot;&gt;
POSIX LC_NUMERIC&lt;&#x2F;a&gt;..html">Namespace container for the JsWorld library objects..Class for localised formatting of numbers.

&lt;p&gt;See: &lt;a href=&quot;http:&#x2F;&#x2F;www.opengroup.org&#x2F;onlinepubs&#x2F;000095399&#x2F;basedefs&#x2F;xbd_chap07.html#tag_07_03_04&quot;&gt;
POSIX LC_NUMERIC&lt;&#x2F;a&gt;.</a></li>
            
                <li><a href="..&#x2F;classes/Namespace container for the JsWorld library objects..Class for parsing localised currency amount strings..html">Namespace container for the JsWorld library objects..Class for parsing localised currency amount strings.</a></li>
            
                <li><a href="..&#x2F;classes/Namespace container for the JsWorld library objects..Class for parsing localised date and time strings..html">Namespace container for the JsWorld library objects..Class for parsing localised date and time strings.</a></li>
            
                <li><a href="..&#x2F;classes/Namespace container for the JsWorld library objects..Class for parsing localised number strings..html">Namespace container for the JsWorld library objects..Class for parsing localised number strings.</a></li>
            
                <li><a href="..&#x2F;classes/Namespace container for the JsWorld library objects..Represents a POSIX-style locale with its numeric, monetary and date&#x2F;time 
properties. Also provides a set of locale helper methods.

&lt;p&gt;The locale properties follow the POSIX standards:

&lt;ul&gt;
    &lt;li&gt;&lt;a href=&quot;http:&#x2F;&#x2F;www.opengroup.org&#x2F;onlinepubs&#x2F;000095399&#x2F;basedefs&#x2F;xbd_chap07.html#tag_07_03_04&quot;&gt;POSIX LC_NUMERIC&lt;&#x2F;a&gt;
    &lt;li&gt;&lt;a href=&quot;http:&#x2F;&#x2F;www.opengroup.org&#x2F;onlinepubs&#x2F;009695399&#x2F;basedefs&#x2F;xbd_chap07.html#tag_07_03_03&quot;&gt;POSIX LC_MONETARY&lt;&#x2F;a&gt;
    &lt;li&gt;&lt;a href=&quot;http:&#x2F;&#x2F;www.opengroup.org&#x2F;onlinepubs&#x2F;000095399&#x2F;basedefs&#x2F;xbd_chap07.html#tag_07_03_05&quot;&gt;POSIX LC_TIME&lt;&#x2F;a&gt;
&lt;&#x2F;ul&gt;.html">Namespace container for the JsWorld library objects..Represents a POSIX-style locale with its numeric, monetary and date&#x2F;time 
properties. Also provides a set of locale helper methods.

&lt;p&gt;The locale properties follow the POSIX standards:

&lt;ul&gt;
    &lt;li&gt;&lt;a href=&quot;http:&#x2F;&#x2F;www.opengroup.org&#x2F;onlinepubs&#x2F;000095399&#x2F;basedefs&#x2F;xbd_chap07.html#tag_07_03_04&quot;&gt;POSIX LC_NUMERIC&lt;&#x2F;a&gt;
    &lt;li&gt;&lt;a href=&quot;http:&#x2F;&#x2F;www.opengroup.org&#x2F;onlinepubs&#x2F;009695399&#x2F;basedefs&#x2F;xbd_chap07.html#tag_07_03_03&quot;&gt;POSIX LC_MONETARY&lt;&#x2F;a&gt;
    &lt;li&gt;&lt;a href=&quot;http:&#x2F;&#x2F;www.opengroup.org&#x2F;onlinepubs&#x2F;000095399&#x2F;basedefs&#x2F;xbd_chap07.html#tag_07_03_05&quot;&gt;POSIX LC_TIME&lt;&#x2F;a&gt;
&lt;&#x2F;ul&gt;</a></li>
            
            </ul>

            <ul id="api-modules" class="apis modules">
            
            </ul>
        </div>
    </div>
</div>

            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
        Show:
        <label for="api-show-inherited">
            <input type="checkbox" id="api-show-inherited" checked>
            Inherited
        </label>

        <label for="api-show-protected">
            <input type="checkbox" id="api-show-protected">
            Protected
        </label>

        <label for="api-show-private">
            <input type="checkbox" id="api-show-private">
            Private
        </label>
        <label for="api-show-deprecated">
            <input type="checkbox" id="api-show-deprecated">
            Deprecated
        </label>

    </div>


            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
                        <h1 class="file-heading">File: node_modules&#x2F;sendgrid&#x2F;node_modules&#x2F;nodemailer&#x2F;lib&#x2F;nodemailer.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">
var Transport = require(&quot;.&#x2F;transport&quot;).Transport,
    MailComposer = require(&quot;mailcomposer&quot;).MailComposer,
    XOAuthGenerator = require(&quot;.&#x2F;xoauth&quot;).XOAuthGenerator,
    helpers = require(&quot;.&#x2F;helpers&quot;),
    packageData;

try{
    packageData = require(&quot;..&#x2F;package.json&quot;);
}catch(E){
    &#x2F;&#x2F; probably node 0.4 which doesn&#x27;t support loading json files as objects
    packageData = JSON.parse(
            require(&quot;fs&quot;).
            readFileSync(
                require(&quot;path&quot;).
                join(
                    __dirname,
                    &quot;..&quot;,
                    &quot;package.json&quot;
                )
            )
        );
}


&#x2F;*
 * Version constants
 *&#x2F;
var X_MAILER_NAME = &quot;Nodemailer&quot;,
    X_MAILER_HOMEPAGE = &quot;http:&#x2F;&#x2F;andris9.github.com&#x2F;Nodemailer&#x2F;&quot;;

module.exports.X_MAILER_NAME = X_MAILER_NAME;
module.exports.X_MAILER_HOMEPAGE = X_MAILER_HOMEPAGE;

&#x2F;&#x2F; Export createTransport method
module.exports.createTransport = function(type, options){
    var transport = new Transport(type, options);
    transport.sendMail = function(options, callback){
        options = options || {};
        options.transport = options.transport || transport;
        sendMail(options, callback);
    };
    return transport;
};

&#x2F;&#x2F;Export createXOAuthGenerator function
module.exports.createXOAuthGenerator = function(options){
    return new XOAuthGenerator(options);
};


&#x2F;&#x2F; Export Transport constructor
module.exports.Transport = Transport;

&#x2F;&#x2F; Export Nodemailer constructor
module.exports.Nodemailer = Nodemailer;

&#x2F;&#x2F; Export sendMail function (and the alias send_mail for legacy)
module.exports.sendMail = module.exports.send_mail = sendMail; 

function sendMail(options, callback){
    var mailer = new Nodemailer(options);
    
    mailer.validateSettings(function(err){
        if(err){
            &#x2F;&#x2F; report validation error back to the client
            return callback(err);
        }else{
            &#x2F;&#x2F; try to send the e-mail message
            mailer.sendMail(callback);
        }
    });
    
    return mailer;
}


&#x2F;**
 * &lt;p&gt;Generates a Nodemailer object which is the main &#x27;hub&#x27; for managing the
 * send process&lt;&#x2F;p&gt;
 * 
 * @constructor
 * @param {Object} options Message options object, see README for the complete list of possible options
 *&#x2F;
function Nodemailer(options){
    this.options = options || {};

    this.transport = this.options.transport;

    if( this.options.encoding ){
      this.mailcomposer = new MailComposer({encoding: this.options.encoding});
    } else {
      this.mailcomposer = new MailComposer();
    }

    if(!this.transport){
        this.transport = this.getGlobalTransport();
    }
}

&#x2F;**
 * &lt;p&gt;Generates an user agent string for Nodemailer with homepage, version etc.&lt;&#x2F;p&gt;
 * 
 * @return {String} user agent string for X-Mailer value
 *&#x2F;
Nodemailer.prototype.generateUserAgentString = function(){
    var details = [];
    
    if(packageData.version){
        details.push(packageData.version);
    }
    
    if(X_MAILER_HOMEPAGE){
        details.push(&quot;+&quot;+X_MAILER_HOMEPAGE);
    }
    
    return X_MAILER_NAME+ (details.length?&quot; (&quot;+details.join(&quot;; &quot;)+&quot;)&quot;:&quot;&quot;);
};

&#x2F;**
 * &lt;p&gt;Add support for legacy transport settings by checking for global
 * variables SMTP, sendmail and SES&lt;&#x2F;p&gt;
 * 
 * @return {Object} {@link Transport} object
 *&#x2F;
Nodemailer.prototype.getGlobalTransport = function(){
    if(this.options.SMTP){
        &#x2F;&#x2F; cache the transport for SMTP as it is actually a connection pool
        if(!this.options.SMTP._smtp_transport){
            this.options.SMTP._smtp_transport = new Transport(&quot;SMTP&quot;, this.options.SMTP);
        }
        return this.options.SMTP._smtp_transport;
    }else if(this.options.sendmail){
        return new Transport(&quot;sendmail&quot;, this.options.sendmail);
    }else if(this.options.SES){
        return new Transport(&quot;SES&quot;, this.options.SES);
    }else if(module.exports.SMTP){
        &#x2F;&#x2F; cache the transport for SMTP as it is actually a connection pool
        if(!module.exports._smtp_transport){
            module.exports._smtp_transport = new Transport(&quot;SMTP&quot;, module.exports.SMTP);
        }
        return module.exports._smtp_transport;
    }else if(module.exports.sendmail){
        return new Transport(&quot;sendmail&quot;, module.exports.sendmail);
    }else if(module.exports.SES){
        return new Transport(&quot;SES&quot;, module.exports.SES);
    }
    return false;
};

&#x2F;**
 * &lt;p&gt;Doesn&#x27;t do much currently, if the future should link to transport
 * validation methods. For example in case of SES should check that AWS
 * keys are set up etc.&lt;&#x2F;p&gt;
 * 
 * @param {Function} callback Callback function to run after validation
 *&#x2F;
Nodemailer.prototype.validateSettings = function(callback){
    if(!this.transport || !this.transport.transport){
        return callback(new Error(&quot;No transport method defined&quot;));
    }
    callback(null);
};

&#x2F;**
 * &lt;p&gt;Send the e-mail message by using data from the original options object
 * and selected transport&lt;&#x2F;p&gt;
 * 
 * @param {Function} callback Callback function to run when the e-mail has been sent (or it failed)
 *&#x2F;
Nodemailer.prototype.sendMail = function(callback){
    &#x2F;&#x2F; compose the e-mail
    this.generateMailObject();
    &#x2F;&#x2F; send the message using preselected transport method
    this.transport.sendMailWithTransport(this.mailcomposer, callback); 
};

&#x2F;**
 * &lt;p&gt;Uses the data from the original options object to compose a mailcomposer
 * e-mail message that can be later streamed to the selected transport&lt;&#x2F;p&gt;
 *&#x2F;
Nodemailer.prototype.generateMailObject = function(){
    
    &#x2F;&#x2F; set envelope data, subject etc.
    this.setGeneralOptions();
    
    &#x2F;&#x2F; set module defined headers (date, message-id, etc.)
    this.setModuleHeaders();
    
    &#x2F;&#x2F; set user defined headers (if any)
    this.setUserHeaders();
    
    &#x2F;&#x2F; set attachments (if any)
    this.setAttachments();
};

&#x2F;**
 * &lt;p&gt;Uses the general options (message sender and receiver, subject body, etc.)
 * to set mailcomposer properties. Includes support for legacy properties.&lt;&#x2F;p&gt;
 *&#x2F;
Nodemailer.prototype.setGeneralOptions = function(){

    &#x2F;&#x2F; generate plaintext if only HTML exists and generateTextFromHTML is true
    if(!(this.options.text || this.options.body) &amp;&amp; (this.options.html) &amp;&amp; 
      this.options.generateTextFromHTML){
        this.options.text = helpers.stripHTML(this.options.html);
    }
    
    var acceptedFields = [&quot;from&quot;, &quot;sender&quot;, &quot;to&quot;, &quot;subject&quot;, &quot;replyTo&quot;, &quot;debug&quot;,
                          &quot;reply_to&quot;, &quot;cc&quot;, &quot;bcc&quot;, &quot;body&quot;, &quot;text&quot;, &quot;html&quot;, 
                          &quot;envelope&quot;],
        mailOptions = {},
        keys = Object.keys(this.options),
        key;

    

    for(var i=0, len=keys.length; i&lt;len; i++){
        key = keys[i];
        if(acceptedFields.indexOf(key) &gt;=0 &amp;&amp; this.options[key]){
            mailOptions[key] = this.options[key];
        }
    }
    
    if(this.options.debug){
        console.log(mailOptions);
    }
    
    this.mailcomposer.setMessageOption(mailOptions);
};

&#x2F;**
 * &lt;p&gt;If the &#x27;headers&#x27; property was set on the options, add the values to the
 * header of the e-mail message&lt;&#x2F;p&gt;
 *&#x2F;
Nodemailer.prototype.setUserHeaders = function(){
    if(typeof this.options.headers != &quot;object&quot;){
        return;
    }
    var keys = Object.keys(this.options.headers),
        key;

    for(var i=0, len=keys.length; i&lt;len; i++){
        key = keys[i];
        if(this.options.headers[key]){
            this.mailcomposer.addHeader(key, this.options.headers[key]);
        }
    }
};

&#x2F;**
 * &lt;p&gt;Add some required headers to the message, such as Date: and Message-Id:&lt;&#x2F;p&gt;
 *&#x2F;
Nodemailer.prototype.setModuleHeaders = function(){
    
    &#x2F;&#x2F; Mailer name + version
    this.mailcomposer.addHeader(&quot;X-Mailer&quot;, this.generateUserAgentString());
    
    &#x2F;&#x2F; Date
    this.mailcomposer.addHeader(&quot;Date&quot;, new Date().toUTCString());
    
    &#x2F;&#x2F; Message ID
    if(this.options.messageId){
        this.mailcomposer.addHeader(&quot;Message-Id&quot;, &quot;&lt;&quot;+this.options.messageId+&quot;&gt;&quot;);
    }else if(this.options.messageId !== false){
        this.mailcomposer.addHeader(&quot;Message-Id&quot;, &quot;&lt;&quot;+
                Date.now()+Math.random().toString(16).substr(1)+&quot;@&quot;+
                X_MAILER_NAME+&quot;&gt;&quot;);
    }
};

&#x2F;**
 * &lt;p&gt;If attachment array is set on the options object, add these attachments
 * to the mailcomposer object&lt;&#x2F;p&gt;
 *&#x2F;
Nodemailer.prototype.setAttachments = function(){
    if(!Array.isArray(this.options.attachments)){
        return;
    }
    var attachment;
    for(var i=0, len=this.options.attachments.length; i&lt;len; i++){
        attachment = this.options.attachments[i];
        attachment.userAgent = attachment.userAgent || this.generateUserAgentString();
        this.mailcomposer.addAttachment(attachment);
    }
};

    </pre>
</div>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="..&#x2F;assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="..&#x2F;assets/js/yui-prettify.js"></script>
<script src="..&#x2F;assets/../api.js"></script>
<script src="..&#x2F;assets/js/api-filter.js"></script>
<script src="..&#x2F;assets/js/api-list.js"></script>
<script src="..&#x2F;assets/js/api-search.js"></script>
<script src="..&#x2F;assets/js/apidocs.js"></script>
</body>
</html>
